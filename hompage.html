<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Attendance form</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div class="contentxd">
      <div class="header">
        <h1>GROUP 1 TEST HEADER BANNER</h1>
      </div>
      <div class="container">
        <div class="left-column">
          <div class="video-container">
            <video width="100%" height="100%" autoplay muted loop playsinline>
              <source src="/public/video.mp4" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        </div>
        <div class="right-column">
          <!-- REGISTER CONTAINER -->
          <div><br /><br /><br /></div>
          <div class="button-container">
            <button onclick="document.getElementById('id01').style.display='block'" style="width: auto" class="buttonX">
              REGISTER</button
            ><br /><br /><br />
          </div>
          <br /><br /><br />
          <div id="id01" class="modal">
            <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
            <form class="modal-content" id="registerForm">
              <div class="containerSign">
                <h1>REGISTER</h1>
                <p>Please fill in this form to create an account.</p>
                <hr />
                <label for="lstName"><b>Last Name</b></label>
                <input class="phBox" type="text" placeholder="Enter your Last Name" name="lstName" required />
                <label for="stName"><b>First Name</b></label>
                <input class="phBox" type="text" placeholder="Enter your First Name" name="stName" required />
                <label for="studentNo"><b>Student Number</b></label>
                <input class="phBox" type="text" placeholder="Enter your Student Number" name="studentNo" required />
                <label for="yrLvl"
                  ><b>Enter your Year Level</b>
                  <select class="yrLvld" id="yrLvld" name="yrLvld" required style="height: 50px; width: 100%; font-size: 40px">
                    <option class="optionO" disabled selected hidden>Choose your year level</option>
                    <option value="1st">1st Year</option>
                    <option value="2nd">2nd Year</option>
                    <option value="3rd">3rd Year</option>
                    <option value="4th">4th Year</option>
                    <option value="5th">5th Year</option>
                  </select>
                </label>
                <br />
                <label for="psw"><b>PinKey</b></label>
                <input class="phBox" type="password" placeholder="Enter 6 digit Pinkey" name="psw" pattern="\d{6}" required />
                <label for="psw-repeat"><b>Repeat PinKey</b></label>
                <input
                  class="phBox"
                  type="password"
                  placeholder="Repeat 6 digit Pinkey"
                  name="psw-repeat"
                  pattern="\d{6}"
                  required
                />
                <p>By creating an account you agree to our <a href="#" style="color: dodgerblue">Terms & Privacy</a>.</p>
                <div class="clearfix">
                  <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">
                    Cancel
                  </button>
                  <button type="submit" class="signupbtn">Sign Up</button>
                </div>
              </div>
            </form>
          </div>

          <!-- SIGN IN CONTAINER -->
          <div class="button-container">
            <button onclick="document.getElementById('id02').style.display='block'" style="width: auto" class="buttonX">
              Sign In
            </button>
          </div>
          <br /><br /><br />
          <div id="id02" class="modal">
            <span onclick="document.getElementById('id02').style.display='none'" class="close" title="Close Modal">&times;</span>
            <form class="modal-content" id="signInForm">
              <div class="containerSign">
                <h1>Sign In</h1>
                <p>Please fill for attendance.</p>
                <hr />
                <label for="studentNo"><b>Student Number</b></label>
                <input class="phBox" type="text" placeholder="Enter your Student Number" name="studentNo" required />
                <label for="psw"><b>Pass key</b></label>
                <input class="phBox" type="password" placeholder="Enter Pass Key" name="psw" required />
                <p><a href="#" style="color: dodgerblue">Forgot PinKey</a>.</p>
                <div class="clearfix">
                  <button type="button" onclick="document.getElementById('id02').style.display='none'" class="cancelbtn">
                    Cancel
                  </button>
                  <button type="submit" class="signupbtn">Sign In</button>
                </div>
              </div>
            </form>
          </div>

          <!-- SIGN OUT CONTAINER -->
          <div class="button-container">
            <button onclick="document.getElementById('id03').style.display='block'" style="width: auto" class="buttonX">
              Sign Out
            </button>
          </div>
          <div id="id03" class="modal">
            <span onclick="document.getElementById('id03').style.display='none'" class="close" title="Close Modal">&times;</span>
            <form class="modal-content" id="signOutForm">
              <div class="containerSign">
                <h1>Sign Out</h1>
                <p>Please fill for attendance.</p>
                <hr />
                <label for="studentNo"><b>Student Number</b></label>
                <input class="phBox" type="text" placeholder="Enter your Student Number" name="studentNo" required />
                <label for="psw"><b>Pass key</b></label>
                <input class="phBox" type="password" placeholder="Enter Pass Key" name="psw" required />
                <p><a href="#" style="color: dodgerblue">Forgot PinKey</a>.</p>
                <div class="clearfix">
                  <button type="button" onclick="document.getElementById('id03').style.display='none'" class="cancelbtn">
                    Cancel
                  </button>
                  <button type="submit" class="signupbtn">Sign Out</button>
                </div>
              </div>
            </form>
          </div>

          <!-- SCRIPT TO CLOSE MODALS -->
          <script>
            // Get the modals
            var modal1 = document.getElementById("id01");
            var modal2 = document.getElementById("id02");
            var modal3 = document.getElementById("id03");

            // When the user clicks anywhere outside of the modals, close them
            window.onclick = function (event) {
              if (event.target == modal1) {
                modal1.style.display = "none";
              } else if (event.target == modal2) {
                modal2.style.display = "none";
              } else if (event.target == modal3) {
                modal3.style.display = "none";
              }
            };
          </script>
          <br /><br />
          <!---ADD VIDEO FROM "get used media"-->
          <!---FOR CAMERA TESTING.-->

          <div id="containerVideo">
            <video autoplay="true" id="videoElement"></video>
          </div>

          <script>
            var video = document.querySelector("#videoElement");

            if (navigator.mediaDevices.getUserMedia) {
              navigator.mediaDevices
                .getUserMedia({ video: true })
                .then(function (stream) {
                  video.srcObject = stream;
                })
                .catch(function (error) {
                  console.log("Something went wrong!");
                });
            }
            if (confirm("This website would like to access your camera. Do you allow?")) {
              startVideoStream();
            } else {
              alert("Camera access denied.");
            }
          </script>
          <!--CLOCK IMPORTANT FOR ATTENDANCE SYSTEM-->
          <br /><br /><br /><br /><br /><br />
          <div id="clock-container">
            <div id="txt"></div>
          </div>

          <script>
            function startTime() {
              const today = new Date();
              let h = today.getHours();
              let m = today.getMinutes();
              let s = today.getSeconds();
              m = checkTime(m);
              s = checkTime(s);
              document.getElementById("txt").innerHTML = "Time: " + h + ":" + m + ":" + s;
              setTimeout(startTime, 1000);
            }

            function checkTime(i) {
              if (i < 10) {
                i = "0" + i;
              } // add zero in front of numbers < 10
              return i;
            }

            window.addEventListener("DOMContentLoaded", (event) => {
              startTime();
            });
          </script>

          <!--registration function-->
          <script>
            document.getElementById("registerForm").addEventListener("submit", async function (event) {
              event.preventDefault();

              // Gather form data
              const formData = new FormData(this);
              const pinKey = formData.get("psw");
              const repeatPinKey = formData.get("psw-repeat");

              // Check if PinKey and Repeat PinKey match
              if (pinKey !== repeatPinKey) {
                alert("PinKey and Repeat PinKey do not match. Please try again.");
                return;
              }

              const data = {
                firstName: formData.get("stName"),
                lastName: formData.get("lstName"),
                studentNumber: formData.get("studentNo"),
                yearLevel: formData.get("yrLvld"),
                pinKey: formData.get("psw"),
              };

              // Send data to the backend
              try {
                const response = await fetch("http://localhost:5000/api/auth/register", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(data),
                });

                const result = await response.json();

                if (result.success) {
                  alert(result.message);
                  document.getElementById("id01").style.display = "none";
                  document.getElementById("registerForm").reset(); // reset fomr fields
                } else {
                  alert(result.message);
                }
              } catch (error) {
                console.error("Error in register:", error);
              }
            });
          </script>

          <!--signin function-->
          <script>
            document.getElementById("signInForm").addEventListener("submit", async function (event) {
              event.preventDefault();

              // Gather form data
              const formData = new FormData(this);
              const studentNumber = formData.get("studentNo");
              const pinKey = formData.get("psw");

              const data = {
                studentNumber,
                pinKey,
              };

              // Send data to the backend
              try {
                const response = await fetch("http://localhost:5000/api/auth/signin", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(data),
                });

                const result = await response.json();

                if (result.success) {
                  alert(result.message);
                  document.getElementById("id02").style.display = "none";
                  document.getElementById("signInForm").reset();
                } else {
                  alert(result.message);
                }
              } catch (error) {
                console.error("Error in signin:", error);
              }
            });
          </script>

          <!--signout function-->
          <script>
            document.getElementById("signOutForm").addEventListener("submit", async function (event) {
              event.preventDefault();

              // Gather form data
              const formData = new FormData(this);
              const studentNumber = formData.get("studentNo");
              const pinKey = formData.get("psw");

              const data = {
                studentNumber,
                pinKey,
              };

              // Send data to the backend
              try {
                const response = await fetch("http://localhost:5000/api/auth/signout", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(data),
                });

                const result = await response.json();

                if (result.success) {
                  alert(result.message);
                  document.getElementById("id03").style.display = "none"; // Close the modal

                  window.location.reload();
                } else {
                  alert(result.message);
                }
              } catch (error) {
                console.error("Error in signout:", error);
              }
            });
          </script>
        </div>
      </div>
    </div>
  </body>
</html>
